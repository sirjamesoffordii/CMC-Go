{
  "version": "2.0.0",
  "options": {
    "shell": {
      "executable": "powershell.exe",
      "args": ["-NoProfile", "-Command"]
    }
  },
  "presentation": {
    "echo": true,
    "reveal": "silent",
    "focus": false,
    "panel": "shared",
    "showReuseMessage": false,
    "close": true
  },
  "tasks": [
    {
      "label": "Dev: Start server",
      "type": "shell",
      "command": "pnpm dev",
      "group": "build",
      "isBackground": true,
      "problemMatcher": []
    },
    {
      "label": "Build: Full build",
      "type": "shell",
      "command": "pnpm build",
      "group": "build",
      "problemMatcher": ["$tsc"]
    },
    {
      "label": "Check: TypeScript",
      "type": "shell",
      "command": "pnpm check",
      "group": "test",
      "problemMatcher": ["$tsc"]
    },
    {
      "label": "Test: Unit tests",
      "type": "shell",
      "command": "pnpm test",
      "group": "test",
      "problemMatcher": []
    },
    {
      "label": "Test: E2E smoke",
      "type": "shell",
      "command": "pnpm e2e",
      "group": "test",
      "problemMatcher": []
    },
    {
      "label": "Format: Prettier",
      "type": "shell",
      "command": "pnpm format",
      "problemMatcher": []
    },
    {
      "label": "DB: Push schema",
      "type": "shell",
      "command": "pnpm db:push:yes",
      "problemMatcher": []
    },
    {
      "label": "DB: Seed database",
      "type": "shell",
      "command": "pnpm db:seed",
      "problemMatcher": []
    },
    {
      "label": "DB: Reset database",
      "type": "shell",
      "command": "pnpm db:reset",
      "problemMatcher": []
    },
    {
      "label": "DB: Full setup",
      "type": "shell",
      "command": "pnpm db:setup",
      "problemMatcher": []
    },
    {
      "label": "Validate: Agent docs",
      "type": "shell",
      "command": "pnpm validate:agents",
      "problemMatcher": []
    },
    {
      "label": "Railway: View logs (100 lines)",
      "type": "shell",
      "command": "railway logs --limit 100",
      "problemMatcher": []
    },
    {
      "label": "Railway: Stream logs (live)",
      "type": "shell",
      "command": "railway logs --follow",
      "isBackground": true,
      "problemMatcher": []
    },
    {
      "label": "Railway: Check status",
      "type": "shell",
      "command": "railway status",
      "problemMatcher": []
    },
    {
      "label": "Railway: View deployments",
      "type": "shell",
      "command": "railway deployments",
      "problemMatcher": []
    },
    {
      "label": "Railway: Search logs for errors",
      "type": "shell",
      "command": "railway logs --limit 200 | Select-String -Pattern 'error|Error|ERROR|failed|Failed|exception|Exception'",
      "problemMatcher": []
    },
    {
      "label": "Git: Status",
      "type": "shell",
      "command": "git status -sb",
      "problemMatcher": []
    },
    {
      "label": "Git: Fetch and status",
      "type": "shell",
      "command": "git fetch --prune origin; git status -sb",
      "problemMatcher": []
    },
    {
      "label": "Git: Hard reset to staging",
      "type": "shell",
      "command": "git fetch --prune origin; git checkout -f staging; git reset --hard origin/staging; git clean -fd; git status -sb",
      "problemMatcher": []
    },
    {
      "label": "Agent: Health check",
      "type": "shell",
      "command": "Write-Host '=== Agent Health Check ==='; Write-Host ''; Write-Host '[Terminal]' -ForegroundColor Cyan; Write-Host \"  echo: $(if ('ok' -eq 'ok') { 'PASS' } else { 'FAIL' })\"; Write-Host ''; Write-Host '[Git]' -ForegroundColor Cyan; $gitStatus = git status -sb 2>&1; if ($LASTEXITCODE -eq 0) { Write-Host \"  git status: PASS ($gitStatus)\" } else { Write-Host '  git status: FAIL' -ForegroundColor Red }; Write-Host ''; Write-Host '[GitHub CLI]' -ForegroundColor Cyan; $ghAuth = gh auth status 2>&1; if ($LASTEXITCODE -eq 0) { Write-Host '  gh auth: PASS' } else { Write-Host '  gh auth: FAIL' -ForegroundColor Red }; Write-Host ''; Write-Host '[Node/pnpm]' -ForegroundColor Cyan; $nodeVer = node --version 2>&1; $pnpmVer = pnpm --version 2>&1; Write-Host \"  node: $nodeVer\"; Write-Host \"  pnpm: $pnpmVer\"; Write-Host ''; Write-Host '[Repo State]' -ForegroundColor Cyan; $branch = git branch --show-current; $clean = git status --porcelain; Write-Host \"  branch: $branch\"; if ([string]::IsNullOrEmpty($clean)) { Write-Host '  working tree: clean' } else { Write-Host \"  working tree: dirty ($($clean.Split([Environment]::NewLine).Count) files)\" -ForegroundColor Yellow }; Write-Host ''; Write-Host '=== Done ===' -ForegroundColor Green",
      "problemMatcher": []
    },
    {
      "label": "Agent: Recover terminal",
      "type": "shell",
      "command": "Write-Host 'Resetting terminal environment...'; $env:GIT_PAGER='cat'; $env:GH_PAGER='cat'; $env:PAGER='cat'; git config --global core.pager cat; Write-Host 'Pager settings reset. Terminal should be usable now.' -ForegroundColor Green",
      "problemMatcher": []
    },
    {
      "label": "GH: PR status (by number)",
      "type": "shell",
      "command": "gh pr view ${input:prNumber} --json url,state,isDraft,title,baseRefName,headRefName,mergeable,mergeStateStatus",
      "problemMatcher": []
    },
    {
      "label": "GH: Checkout PR (clean)",
      "type": "shell",
      "command": "git reset --hard; git clean -fd; gh pr checkout ${input:prNumber}; git status -sb",
      "problemMatcher": []
    },
    {
      "label": "GH: Merge PR (squash)",
      "type": "shell",
      "command": "gh pr merge ${input:prNumber} --squash --delete-branch",
      "problemMatcher": []
    },
    {
      "label": "Git: Rebase onto staging (no editor)",
      "type": "shell",
      "command": "git fetch --prune origin; git -c core.editor=true rebase origin/staging",
      "problemMatcher": []
    },
    {
      "label": "Git: Rebase continue",
      "type": "shell",
      "command": "git -c core.editor=true rebase --continue",
      "problemMatcher": []
    },
    {
      "label": "Git: Rebase abort",
      "type": "shell",
      "command": "git rebase --abort; git status -sb",
      "problemMatcher": []
    },
    {
      "label": "Git: Push force-with-lease",
      "type": "shell",
      "command": "git push --force-with-lease",
      "problemMatcher": []
    },
    {
      "label": "Git: Commit (message prompt)",
      "type": "shell",
      "command": "git add -A; git commit -m '${input:commitMessage}' --no-verify",
      "problemMatcher": []
    },
    {
      "label": "Agent: Spawn worktree agent",
      "type": "shell",
      "command": ".\\scripts\\spawn-worktree-agent.ps1 -IssueNumber ${input:issueNumber}",
      "problemMatcher": []
    },
    {
      "label": "Agent: Spawn worktree agent (dry run)",
      "type": "shell",
      "command": ".\\scripts\\spawn-worktree-agent.ps1 -IssueNumber ${input:issueNumber} -DryRun",
      "problemMatcher": []
    },
    {
      "label": "Agent: List worktrees",
      "type": "shell",
      "command": "git worktree list",
      "problemMatcher": []
    },
    {
      "label": "Agent: Clean worktree",
      "type": "shell",
      "command": "git worktree remove --force C:\\Dev\\CMC-Go-Worktrees\\wt-impl-${input:issueNumber}; Write-Host 'Worktree removed' -ForegroundColor Green",
      "problemMatcher": []
    },
    {
      "label": "Agent: Spawn cloud agent (issue)",
      "type": "shell",
      "command": ".\\scripts\\spawn-cloud-agent.ps1 -IssueNumber ${input:issueNumber}",
      "problemMatcher": [],
      "detail": "Spawn a GitHub cloud agent for an issue (non-blocking)"
    },
    {
      "label": "Agent: Spawn cloud agent (prompt)",
      "type": "shell",
      "command": ".\\scripts\\spawn-cloud-agent.ps1 -Prompt '${input:agentPrompt}'",
      "problemMatcher": [],
      "detail": "Spawn a GitHub cloud agent with custom prompt (non-blocking)"
    },
    {
      "label": "Agent: List cloud agent tasks",
      "type": "shell",
      "command": "gh agent-task list",
      "problemMatcher": [],
      "detail": "List recent GitHub Copilot coding agent tasks"
    },
    {
      "label": "Agent: View cloud agent task",
      "type": "shell",
      "command": "gh agent-task view ${input:prNumber}",
      "problemMatcher": [],
      "detail": "View a specific cloud agent task by PR number"
    }
  ],
  "inputs": [
    {
      "id": "prNumber",
      "type": "promptString",
      "description": "PR number to operate on"
    },
    {
      "id": "commitMessage",
      "type": "promptString",
      "description": "Commit message"
    },
    {
      "id": "issueNumber",
      "type": "promptString",
      "description": "GitHub Issue number"
    },
    {
      "id": "agentPrompt",
      "type": "promptString",
      "description": "Prompt for the cloud agent"
    }
  ]
}

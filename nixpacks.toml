# Railway/Nixpacks: pin Node to avoid build-to-build drift
[phases.setup]
# You can switch to 20.x if you prefer LTS-only
nixPkgs = ["nodejs_22", "pnpm"]

[phases.install]
cmds = ["corepack enable", "pnpm install --frozen-lockfile"]

[phases.build]
# CI pre-builds dist/; only rebuild if dist/ is missing (e.g. Railway auto-deploy)
cmds = ["if [ -f dist/index.js ]; then echo 'Using pre-built dist/'; else pnpm build; fi"]

[start]
cmd = "pnpm start"
